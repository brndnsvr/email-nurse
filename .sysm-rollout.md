# SYSM Full Rollout - Tracking Document

**Rollout Date:** 2026-02-05
**Review Date:** 2026-02-06 evening (24 hours)

## Status: ✅ LIVE IN PRODUCTION

sysm is now **fully enabled** in production. The autopilot service is using sysm exclusively for message retrieval.

---

## What Changed

### Production Configuration
- **File:** `~/.config/email-nurse/autopilot.yaml`
- **Setting:** `message_provider: sysm`
- **Previous:** `applescript` (implicit default)
- **Current:** `sysm` (explicit)

### Code Changes Deployed

**Commit 1:** `2e5b04f` - sysm integration
- sysm wrapper module
- Provider selection logic in messages.py
- 46 comprehensive tests (100% passing)

**Commit 2:** `7663ac5` - Performance tracking
- Automatic metrics logging to `~/.config/email-nurse/metrics.jsonl`
- CLI command for performance review
- Cross-session persistence

---

## Performance Tracking

### Automatic Tracking
Every autopilot run automatically logs:
- Operation duration (message fetches, etc.)
- Provider used (sysm/applescript)
- Message counts
- Success/failure status
- Timestamps

**Metrics File:** `~/.config/email-nurse/metrics.jsonl`

### Review Commands

**24-Hour Review (Tomorrow Evening):**
```bash
email-nurse autopilot performance
```

**Custom Time Ranges:**
```bash
email-nurse autopilot performance --hours 12   # Last 12 hours
email-nurse autopilot performance --hours 48   # Last 48 hours
```

**JSON Export:**
```bash
email-nurse autopilot performance --json > sysm-report.json
```

**Alternative Script:**
```bash
python scripts/performance_review.py 24
```

---

## What to Look For (Tomorrow)

### Success Metrics
1. **Speedup Percentage**
   - Look for: `⚡ SYSM SPEEDUP: +XX%`
   - Target: 40-51% faster (based on benchmarks)

2. **Zero Failures**
   - Check: `Failed Operations: 0`
   - All operations should succeed

3. **Message Count Accuracy**
   - Verify counts match expected inbox sizes

### Comparison Points

The report will show:
```
MESSAGE RETRIEVAL PERFORMANCE:
  sysm:
    Avg Duration: X.XXs
    Operations: XX
    Messages: XXX

  ⚡ SYSM SPEEDUP: +XX.X%
     sysm is XX.X% faster than AppleScript
```

---

## Known Limitations (To Address)

1. **Missing RFC 822 Message-ID**
   - sysm doesn't provide the Message-ID header
   - Currently set to empty string `""`
   - **Impact:** Low - current code doesn't heavily rely on it
   - **Action:** You're investigating sysm fix

2. **Mailbox Operations**
   - Still using AppleScript for mailbox listing
   - **Reason:** AppleScript 7.4x faster for this specific operation
   - **Impact:** None - only used during initial mailbox enumeration

3. **Content Truncation Difference**
   - AppleScript: Truncates at 5000 chars
   - sysm: Returns full content
   - **Impact:** May affect memory usage on very large emails
   - **Action:** Monitor, may add truncation to sysm path if needed

---

## Rollback Procedure

If issues arise, rollback is instant:

1. **Edit config:**
   ```bash
   vim ~/.config/email-nurse/autopilot.yaml
   ```
   Change: `message_provider: sysm` → `message_provider: applescript`

2. **Restart service:**
   ```bash
   launchctl kickstart -k gui/501/com.bss.email-nurse
   ```

3. **Verify:**
   ```bash
   tail -f ~/Library/Logs/email-nurse-iCloud.log
   ```
   Look for AppleScript usage (no sysm mentions)

**No code changes needed** - just config change.

---

## Service Status

The autopilot runs every **5 minutes** via launchd:
```bash
launchctl list | grep email-nurse
```

Active service: `com.bss.email-nurse`

To check recent runs:
```bash
tail -100 ~/Library/Logs/email-nurse-iCloud.log | grep "Fetching"
```

Look for lines like:
```
Retrieved XX message(s) metadata via sysm from INBOX
```

---

## Testing Checklist (Ongoing)

During the 24-hour period, verify:

- [ ] Autopilot runs complete successfully (check logs)
- [ ] Emails are being processed (inbox counts decreasing)
- [ ] No error messages in logs
- [ ] Quick rules still work
- [ ] AI classification still works
- [ ] Move operations succeed
- [ ] Performance metrics accumulating in metrics.jsonl

---

## Tomorrow Evening Review Plan

1. **Generate Report**
   ```bash
   email-nurse autopilot performance
   ```

2. **Check Key Metrics**
   - Total operations
   - Success rate (should be 100%)
   - Average speedup percentage
   - Any errors or anomalies

3. **Decision Point**
   - **If speedup ≥ 30% and zero errors:** KEEP sysm ✅
   - **If speedup < 20% or errors present:** INVESTIGATE
   - **If critical issues:** ROLLBACK

4. **Document Findings**
   - Update this file with actual results
   - Note any quirks or issues discovered
   - Confirm sysm limitations in practice

---

## Files to Monitor

- **Logs:** `~/Library/Logs/email-nurse-*.log`
- **Metrics:** `~/.config/email-nurse/metrics.jsonl`
- **Config:** `~/.config/email-nurse/autopilot.yaml`
- **Database:** `~/.config/email-nurse/autopilot.db`

---

## Contact Points

If sysm issues arise that need fixing:
1. Check sysm GitHub issues/docs
2. Test sysm CLI directly: `sysm mail inbox --json --limit 10`
3. Verify sysm provides needed data fields
4. Consider hybrid mode if partial sysm support needed

---

**Next Review:** Tomorrow evening (2026-02-06)
**Tracking Since:** 2026-02-05 (this commit)
**Expected Baseline:** ~12+ autopilot runs (5min intervals × 24hrs = 288 runs)
